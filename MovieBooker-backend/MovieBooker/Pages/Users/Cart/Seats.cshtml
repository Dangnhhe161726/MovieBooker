@page
@model MovieBooker.Pages.Users.Cart.BookSeatModel
@{
}
<link rel="stylesheet" href="~/css/Seat.css" asp-append-version="true" />
<div class="container">
    <h1>BOOKING ONLINE</h1>
    <div class="details">
        @foreach (var m in Model.schedules)
        {
            <p>@m.TheaterName | Cinema 7 | Số ghế (106/106)</p>
            <p>@m.ScheduleDate.Value.ToString("dd/MM/yyyy") @m.TimeSlot</p>
        }
    </div>
    <div class="screen"></div>
    <div class="seating-chart">
        <div class="seat-row">
            @foreach (var rowa in Model.seats)
            {
                @if (rowa.SeatTypeName.Trim().Equals("regular") && rowa.Row.Trim().Equals("A"))
                {
                    <div class="seat regular" data-seat="@rowa.SeatNumber">@rowa.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowb in Model.seats)
            {

                @if (rowb.SeatTypeName.Trim().Equals("regular") && rowb.Row.Trim().Equals("B"))
                {
                    <div class="seat regular" data-seat="@rowb.SeatNumber">@rowb.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowc in Model.seats)
            {
                @if (rowc.SeatTypeName.Trim().Equals("regular") && rowc.Row.Trim().Equals("C"))
                {
                    <div class="seat regular" data-seat="@rowc.SeatNumber">@rowc.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowd in Model.seats)
            {
                @if (rowd.SeatTypeName.Trim().Equals("vip") && rowd.Row.Trim().Equals("D"))
                {
                    <div class="seat vip" data-seat="@rowd.SeatNumber">@rowd.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowe in Model.seats)
            {
                @if (rowe.SeatTypeName.Trim().Equals("vip") && rowe.Row.Trim().Equals("E"))
                {
                    <div class="seat vip" data-seat="@rowe.SeatNumber">@rowe.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowf in Model.seats)
            {
                @if (rowf.SeatTypeName.Trim().Equals("vip") && rowf.Row.Trim().Equals("F"))
                {
                    <div class="seat vip" data-seat="@rowf.SeatNumber">@rowf.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowg in Model.seats)
            {
                @if (rowg.SeatTypeName.Trim().Equals("vip") && rowg.Row.Trim().Equals("G"))
                {
                    <div class="seat vip" data-seat="@rowg.SeatNumber">@rowg.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowh in Model.seats)
            {
                @if (rowh.SeatTypeName.Trim().Equals("vip") && rowh.Row.Trim().Equals("H"))
                {
                    <div class="seat vip" data-seat="@rowh.SeatNumber">@rowh.SeatNumber</div>
                }
            }
        </div>
        <div class="seat-row">
            @foreach (var rowi in Model.seats)
            {
                @if (rowi.SeatTypeName.Trim().Equals("sweetbox") && rowi.Row.Trim().Equals("I"))
                {
                    <div class="seat sweetbox" data-seat="@rowi.SeatNumber">@rowi.SeatNumber</div>
                }
            }
        </div>
        <!-- Row D -->
@*        <div class="seat-row">
            <div class="seat vip selected" data-seat="D1">D1</div>
            <div class="seat vip selected" data-seat="D2">D2</div>
            <div class="seat vip" data-seat="D3">D3</div>
            <div class="seat vip" data-seat="D4">D4</div>
            <div class="seat vip" data-seat="D5">D5</div>
            <div class="seat vip" data-seat="D6">D6</div>
            <div class="seat vip" data-seat="D7">D7</div>
            <div class="seat vip" data-seat="D8">D8</div>
            <div class="seat vip" data-seat="D9">D9</div>
            <div class="seat vip" data-seat="D10">D10</div>
            <div class="seat vip" data-seat="D11">D11</div>
            <div class="seat vip" data-seat="D12">D12</div>
        </div>*@
    </div>
    <div class="legend">
        <div><span class="legend-box checked"></span> Checked</div>
        <div><span class="legend-box selected"></span> Đã chọn</div>
        <div><span class="legend-box regular"></span> Thường</div>
        <div><span class="legend-box vip"></span> VIP</div>
        <div><span class="legend-box sweetbox"></span> Sweetbox</div>
    </div>
    <div class="movie-details">
        @foreach (var m in Model.schedules)
        {
            <button class="previous">&lt; PREVIOUS</button>
            <div class="movie-info">
                <img src="@m.movieImage" alt="Movie Poster">
                <div class="movie-description">
                    <p>@m.MovieTitle</p>
                    <p>Rap: @m.TheaterName</p>
                    <p>Suất chiếu: @m.TimeSlot, @m.ScheduleDate.Value.ToString("dd/MM/yyyy")</p>
                    <p>Phòng chiếu: Cinema 6</p>
                    <p id="selected-seats">Ghế: </p>
                </div>
                <div class="movie-pricing">
                    <p>Tên phim: 249.818,00 đ</p>
                    <p>Combo: 0,00 đ</p>
                    <p>Tổng: 249.818,00 đ</p>
                </div>
            </div>
            <button class="next">NEXT &gt;</button>
        }
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const seats = document.querySelectorAll('.seat');
        const selectedSeatsElement = document.getElementById('selected-seats');

        let firstSelectedType = null;
        let selectedSeats = [];

        seats.forEach(seat => {
            seat.addEventListener('click', () => {
                if (seat.classList.contains('selected')) {
                    alert('Seat cannot be selected');
                } else if (seat.classList.contains('checked')) {
                    seat.classList.remove('checked');
                    firstSelectedType = null;
                    selectedSeats = selectedSeats.filter(s => s !== seat.dataset.seat);
                } else {
                    const seatType = getSeatType(seat.dataset.seat);
                    if (firstSelectedType === null) {
                        firstSelectedType = seatType;
                        seat.classList.add('checked');
                        selectedSeats.push(seat.dataset.seat);
                    } else {
                        if (seatType === firstSelectedType) {
                            seat.classList.add('checked');
                            selectedSeats.push(seat.dataset.seat);
                        } else {
                            alert('Bạn phải chọn ghế cùng loại.');
                        }
                    }
                }
                updateSelectedSeats();
            });
        });

        function getSeatType(seatName) {
            if (seatName.startsWith('A') || seatName.startsWith('B') || seatName.startsWith('C')) {
                return 'regular';
            } else if (seatName.startsWith('D') || seatName.startsWith('E') || seatName.startsWith('F') || seatName.startsWith('G') || seatName.startsWith('H')) {
                return 'vip';
            } else if (seatName.startsWith('I')) {
                return 'sweetbox';
            }
            return 'unknown';
        }

        function updateSelectedSeats() {
            const seatTypes = {
                'regular': 'Thường',
                'vip': 'Vip',
                'sweetbox': 'Sweetbox'
            };
            const seatsByType = selectedSeats.reduce((acc, seat) => {
                const type = getSeatType(seat);
                if (!acc[type]) acc[type] = [];
                acc[type].push(seat);
                return acc;
            }, {});

            let displayText = 'Ghế: ';
            for (const [type, seats] of Object.entries(seatsByType)) {
                displayText += `${seatTypes[type]} ${seats.join(', ')}, `;
            }
            selectedSeatsElement.textContent = displayText.slice(0, -2);
        }
    });

</script>


